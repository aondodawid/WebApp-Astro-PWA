---
import ServiceWorkerRegistration from "./view/components/ServiceWorkerRegistration.astro";
import MetaServiceWorker from "./view/components/MetaServiceWorker.astro";
import pwaOptions from "../pwa.config.json";

const isShowManifest = (pwaOptions as any)?.isManifest || false;
---

{isShowManifest && <MetaServiceWorker />}
<ServiceWorkerRegistration />
<script is:inline>
  import pwaOptions from "../pwa.config.json";
  if (pwaOptions?.forceUpdate && 'serviceWorker' in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        for (const registration of registrations) {
          registration.update(); // Forces the browser to check for an updated sw.js
        }
      });
    });
  }
</script>
