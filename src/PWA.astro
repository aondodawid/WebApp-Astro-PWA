---
import ServiceWorkerRegistration from "./view/components/ServiceWorkerRegistration.astro";
import MetaServiceWorker from "./view/components/MetaServiceWorker.astro";
import pwaOptions from "../pwa.config.json";

type PWAOptions = {
  isMansifest?: boolean;
  forceUpdate?: boolean;
  // add other properties from your pwa.config.json as needed
};

const isShowManifest = (pwaOptions as PWAOptions)?.isMansifest || false;
---

{isShowManifest && <MetaServiceWorker />}
<ServiceWorkerRegistration />
<script>
  import pwaOptions from "../pwa.config.json";

  if (pwaOptions?.forceUpdate && "serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.getRegistrations().then((registrations) => {
        registrations.forEach(function (registration) {
          registration.update();
        });
      });
    });
  }
</script>
